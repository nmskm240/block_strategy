# BlockStrategy 仕様 / 設計書

## 1. プロジェクト概要

BlockStrategy は、  
**Blocklyによるビジュアルプログラミングでトレード戦略を構築し、  
中間言語（Strategy IL）を介してバックテスト・コード生成を行うプラットフォーム**である。

- ノーコード〜ローコード層でも戦略ロジックを表現できる
- 特定の実行基盤（Backtrader / Pine Script 等）に依存しない
- 戦略の「構造」を明示的に扱えることを重視する

## 2. 目的・思想

### 2.1 解決したい課題

- トレード戦略は **コード or GUIツールに閉じがち**
  - ツールやコードの勉強ハードルを感じる人がいる
- ロジックの再利用・変換・検証が難しい
- 「戦略の意図」と「実装」が密結合しすぎている

### 2.2 設計思想

- **戦略 = ドメイン**
- 実行環境は後付け（アダプタ）
- BlocklyはUI、真の本体は中間言語
- すべてブラウザで完結させる
  - 外部にエッジが漏れない

## 3. レイヤ構成（DDDベース）

```
.
├── client
│   └── src
│       ├── adapter
│       ├── presentation
│       └── lib
│           ├── blockly
│           └── pyodide
├── server
│   └── src
│       ├── interface
│       └── infra
└── shared
    └── src
        ├── application
        ├── domain
        └── types
```

## 4. Strategy IL（中間言語）

### 4.1 役割

- Blocklyのブロック構造をSQLライクな **実行非依存な形で保持**
- 条件・式・アクションを構造化
- 各実行環境への変換元

## 5. Blockly設計方針

### 5.1 Blocklyの責務

- ユーザー入力の補助
- 構造制約の強制
- 視覚的フィードバック

※ **ロジックの意味は持たない**

## 6. バックテスト設計

### 6.1 基本方針

- Strategy IL → Backtrader Strategy へ変換
- ユーザーコードは直接実行しない
- 実行はアプリケーション層で制御

### 6.2 出力

- 取引履歴
- パフォーマンス指標
- QuantStats連携

## 7. コード生成（将来拡張）

- Pine Script / MQLへの変換
- Python（Backtrader以外）
- 疑似コード出力

## 8. 非目標（やらないこと）

- 自動売買の直接提供
- 取引所APIの直接操作

## 9. 今後の検討事項

- Strategy ILのバージョニング
- 戦略テンプレート
- Blocklyプロジェクトのローカル保存
- マルチタイムフレーム対応
